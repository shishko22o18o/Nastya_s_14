<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>–ù–∞—Å—Ç—è ‚ù§Ô∏è Valentine –¥–∏–∞–ª–æ–≥–∏</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }

    body {
      background: linear-gradient(145deg, #fce4ec 0%, #ffe0f0 50%, #ffd9e8 100%);
      color: #2d2d2d;
      overflow: hidden;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><path fill="%23ff99cc" d="M50 30c-5-10-20-10-25 0-5 10 5 25 25 35 20-10 30-25 25-35-5-10-20-10-25 0z"/></svg>');
      background-size: 80px 80px;
      pointer-events: none;
      z-index: 0;
    }

    .app {
      height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      z-index: 2;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: 0 0 30px rgba(255, 150, 200, 0.3);
    }

    .topbar {
      background: rgba(255, 220, 240, 0.7);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      padding: 16px 14px;
      font-weight: 700;
      font-size: 22px;
      color: #b3406c;
      text-shadow: 0 2px 4px rgba(255,255,255,0.5);
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid #ffb3d1;
    }

    .topbar span {
      background: #ffb3d1;
      color: #9e2a5b;
      padding: 4px 12px;
      border-radius: 40px;
      font-size: 14px;
      font-weight: 500;
      margin-left: auto;
    }

    .chat-list {
      flex: 1;
      overflow-y: auto;
      padding: 4px 8px;
    }

    .chat-item {
      display: flex;
      align-items: center;
      padding: 12px;
      gap: 12px;
      background: rgba(255, 255, 255, 0.5);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      border-radius: 28px;
      margin-bottom: 8px;
      border: 1px solid rgba(255, 200, 220, 0.7);
      transition: all 0.2s;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(255, 160, 200, 0.1);
    }

    .chat-item:hover {
      background: rgba(255, 230, 240, 0.9);
      transform: scale(1.01);
      border-color: #ffa5c3;
    }

    .avatar {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-size: cover;
      background-position: center;
      border: 2px solid white;
      box-shadow: 0 4px 8px rgba(255, 100, 150, 0.3);
    }

    .chat-info {
      flex: 1;
    }

    .chat-name {
      font-weight: 700;
      color: #87234f;
      font-size: 17px;
    }

    .chat-last {
      font-size: 14px;
      color: #a04d6e;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 180px;
    }

    .chat-time {
      font-size: 12px;
      color: #b06d89;
      background: rgba(255,255,240,0.5);
      padding: 4px 8px;
      border-radius: 30px;
    }

    .chat-window {
      position: absolute;
      top: 0;
      left: 100%;
      width: 100%;
      height: 100%;
      background: rgba(255, 245, 250, 0.85);
      backdrop-filter: blur(25px);
      -webkit-backdrop-filter: blur(25px);
      display: flex;
      flex-direction: column;
      transition: left 0.35s cubic-bezier(0.2, 0.9, 0.3, 1);
      z-index: 10;
      box-shadow: -10px 0 30px rgba(210, 120, 160, 0.3);
    }

    .chat-window.active {
      left: 0;
    }

    .chat-header {
      background: rgba(255, 210, 230, 0.7);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      padding: 10px 16px;
      display: flex;
      gap: 12px;
      align-items: center;
      border-bottom: 1px solid #ffbfd7;
    }

    .back {
      cursor: pointer;
      font-size: 26px;
      color: #ad3f6b;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: white;
      box-shadow: 0 2px 8px rgba(255,120,160,0.3);
      transition: 0.2s;
    }

    .back:hover {
      background: #ffe5f0;
    }

    .chat-header .avatar {
      width: 48px;
      height: 48px;
    }

    #chatTitle {
      font-weight: 700;
      font-size: 18px;
      color: #831d48;
    }

    #status {
      font-size: 13px;
      color: #c54773;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    #status::before {
      content: '‚óè';
      color: #4caf50;
      font-size: 10px;
      animation: pulse 1.2s infinite;
    }

    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } }

    .messages {
      flex: 1;
      padding: 16px 12px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: rgba(255, 235, 245, 0.2);
    }

    .message {
      max-width: 80%;
      padding: 10px 14px;
      border-radius: 22px;
      font-size: 15px;
      line-height: 1.4;
      animation: messagePop 0.2s ease-out;
      box-shadow: 0 2px 10px rgba(170, 100, 130, 0.15);
      word-wrap: break-word;
    }

    @keyframes messagePop {
      0% { opacity: 0; transform: translateY(8px) scale(0.96); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    .sent {
      align-self: flex-end;
      background: #f9c9df;
      color: #451f2f;
      border-bottom-right-radius: 6px;
    }

    .received {
      align-self: flex-start;
      background: white;
      color: #381f2b;
      border-bottom-left-radius: 6px;
    }

    .time {
      font-size: 10px;
      color: #a5697e;
      margin-left: 8px;
      opacity: 0.8;
    }

    .input-area {
      display: flex;
      padding: 10px 12px;
      background: rgba(255, 220, 235, 0.6);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      gap: 8px;
      border-top: 1px solid #ffbfd7;
    }

    #userInput {
      flex: 1;
      padding: 12px 18px;
      border: none;
      border-radius: 40px;
      background: rgba(255, 255, 255, 0.9);
      color: #2f1d26;
      font-size: 15px;
      box-shadow: inset 0 2px 6px rgba(210, 120, 150, 0.2);
    }

    #userInput:focus {
      outline: 2px solid #ff99c2;
    }

    button {
      padding: 12px 20px;
      border: none;
      border-radius: 40px;
      background: #ff99c2;
      color: white;
      font-weight: 600;
      font-size: 16px;
      box-shadow: 0 4px 10px #fbb0cf;
      transition: 0.15s;
      cursor: pointer;
    }

    button:hover {
      background: #ff80b5;
      transform: scale(1.02);
    }

    /* –∫–Ω–æ–ø–∫–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤ */
    .options-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin: 10px 0 5px;
    }

    .option-btn {
      background: white;
      border: 2px solid #ff99c2;
      color: #b34e7a;
      padding: 12px 18px;
      border-radius: 40px;
      font-size: 15px;
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(255, 150, 200, 0.4);
      cursor: pointer;
      transition: 0.15s;
      flex: 1 1 auto;
      min-width: 120px;
    }

    .option-btn:hover {
      background: #ffe2f0;
      transform: scale(1.02);
    }

    .heart {
      position: fixed;
      font-size: 28px;
      animation: floatUp 5s linear forwards;
      z-index: 9999;
      pointer-events: none;
      filter: drop-shadow(0 0 6px hotpink);
    }

    @keyframes floatUp {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(-100vh) rotate(10deg); opacity: 0; }
    }

    .desktop-hint {
      position: fixed;
      bottom: 10px;
      left: 0;
      right: 0;
      z-index: 999;
      text-align: center;
      color: #b04e77;
      text-shadow: 0 1px 4px white;
      font-size: 16px;
      background: rgba(255, 240, 245, 0.6);
      padding: 6px;
      border-radius: 40px;
      width: fit-content;
      margin: 0 auto;
      backdrop-filter: blur(2px);
    }
  </style>
</head>
<body>

<audio id="bgMusic" loop volume="0.2">
  <source src="https://cdn.pixabay.com/audio/2023/09/17/audio_0b4a5e6f5d.mp3" type="audio/mpeg">
</audio>

<div class="app">
  <div class="topbar">
    üå∏ –ù–∞—Å—Ç—è ‚ù§Ô∏è
    <span>14 —Ñ–µ–≤</span>
  </div>
  <div class="chat-list" id="chatList"></div>
</div>

<div class="chat-window" id="chatWindow">
  <div class="chat-header">
    <div class="back" onclick="closeChat()">‚Üê</div>
    <div class="avatar" id="chatAvatar"></div>
    <div style="flex:1">
      <div id="chatTitle"></div>
      <div id="status">–≤ —Å–µ—Ç–∏</div>
    </div>
  </div>

  <div class="messages" id="messages"></div>

  <!-- –æ–±–ª–∞—Å—Ç—å –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∫–Ω–æ–ø–æ–∫ –æ—Ç–≤–µ—Ç–æ–≤ -->
  <div id="optionsArea" class="input-area" style="justify-content: center; display: none;"></div>

  <!-- –æ–±—ã—á–Ω—ã–π –∏–Ω–ø—É—Ç (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π, –º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å) -->
  <div class="input-area" id="manualInputArea" style="display: flex;">
    <input id="userInput" placeholder="–¢–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
    <button onclick="sendManualMessage()">üí¨</button>
  </div>
</div>

<script>
  (function() {
    const HER_NAME = '–ù–∞—Å—Ç—è';

    // ---- –Ω–µ–∂–Ω—ã–µ –∞–≤–∞—Ç–∞—Ä—ã ----
    const avatars = [
      'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=200&q=80',
      'https://images.unsplash.com/photo-1489424731084-a5d8b219a5bb?w=200&q=80',
      'https://images.unsplash.com/photo-1494790108777-466ad68012e6?w=200&q=80',
      'https://images.unsplash.com/photo-1504215680853-026ed2f45def?w=200&q=80',
      'https://images.unsplash.com/photo-1516690561799-46d8f74f9abf?w=200&q=80',
      'https://images.unsplash.com/photo-1516589170053-32470a61c0f7?w=200&q=80',
      'https://images.unsplash.com/photo-1516826738060-3c6f38b10ad4?w=200&q=80',
      'https://images.unsplash.com/photo-1518557985387-e0f4b0a8f3c2?w=200&q=80'
    ];

    // ==================== –î–ò–ê–õ–û–ì–ò (—Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–æ–≤) ====================
    const chats = [
      { // 0. –ò–ª—å—è –ö—É–Ω ‚ù§Ô∏è ‚Äî —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Å –ø—Ä–∏–∑–Ω–∞–Ω–∏–µ–º
        name: '–ò–ª—å—è –ö—É–Ω ‚ù§Ô∏è',
        dialog: [
          { person: `${HER_NAME}, –ø—Ä–∏–≤–µ—Ç... —ç—Ç–æ –Ω–µ–º–Ω–æ–≥–æ –≤–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ`, options: [
              { text: '–ü—Ä–∏–≤–µ—Ç! –ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å?', nextPerson: '–ü—Ä–æ—Å—Ç–æ —Å–µ–≥–æ–¥–Ω—è –¥–µ–Ω—å —Ç–∞–∫–æ–π... –≤—Å—ë –¥—É–º–∞—é –æ —Ç–µ–±–µ. –¢—ã —Ç–∞–∫–∞—è –Ω–µ–∂–Ω–∞—è...' },
              { text: '–¢—ã –º–µ–Ω—è –ø—É–≥–∞–µ—à—å))', nextPerson: '–ù–µ –ø—É–≥–∞–π—Å—è, –ø—Ä–æ—Å—Ç–æ —Ö–æ—á—É —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Ç—ã –æ—á–µ–Ω—å –∫—Ä–∞—Å–∏–≤–∞—è —Å–µ–≥–æ–¥–Ω—è (–∫–∞–∫ –∏ –≤—Å–µ–≥–¥–∞).' }
          ]},
          { person: '–ü–æ–º–Ω–∏—à—å –Ω–∞—à—É –ø–µ—Ä–≤—É—é –≤—Å—Ç—Ä–µ—á—É? –¢—ã —É–ª—ã–±–Ω—É–ª–∞—Å—å, –∏ —É –º–µ–Ω—è –≤–Ω—É—Ç—Ä–∏ –≤—Å—ë –ø–µ—Ä–µ–≤–µ—Ä–Ω—É–ª–æ—Å—å.', options: [
              { text: '–ö–æ–Ω–µ—á–Ω–æ –ø–æ–º–Ω—é, —Ç—ã –±—ã–ª –º–∏–ª—ã–º', nextPerson: '–ü—Ä–∞–≤–¥–∞? –Ø —Ç–∞–∫ —Å—Ç–µ—Å–Ω—è–ª—Å—è —Ç–æ–≥–¥–∞... –ù–æ —Ç—ã –º–µ–Ω—è –æ—á–∞—Ä–æ–≤–∞–ª–∞.' },
              { text: '–ê –º–Ω–µ –∑–∞–ø–æ–º–Ω–∏–ª—Å—è —Ç–≤–æ–π —Å–º–µ—Ö', nextPerson: '–û–π, –∞ —è –¥—É–º–∞–ª, —è —Å–µ—Ä—å—ë–∑–Ω—ã–º –∫–∞–∑–∞–ª—Å—è... –†–∞–¥, —á—Ç–æ —Ç—ã —Å–º–µ—è–ª–∞—Å—å.' }
          ]},
          { person: '–¢–≤–æ–∏ –≥–ª–∞–∑–∞ ‚Äî –∫–∞–∫ –¥–≤–∞ —Ç—ë–ø–ª—ã—Ö –æ–≥–æ–Ω—å–∫–∞. –Ø –º–æ–≥—É —Å–ª—É—à–∞—Ç—å —Ç–≤–æ–π —Å–º–µ—Ö –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ.', options: [
              { text: '–¢—ã —Å–µ–≥–æ–¥–Ω—è —Ç–∞–∫–æ–π —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–π üíï', nextPerson: '–≠—Ç–æ –≤—Å—ë —Ç—ã... –†—è–¥–æ–º —Å —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è –±—ã—Ç—å –ø–æ—ç—Ç–æ–º.' },
              { text: 'üòä –°–ø–∞—Å–∏–±–æ, –º–Ω–µ –ø—Ä–∏—è—Ç–Ω–æ', nextPerson: '–¢–µ–±–µ —Å–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å. –¢—ã –æ—Å–æ–±–µ–Ω–Ω–∞—è.' }
          ]},
          { person: '–Ø —Ö–æ—á—É, —á—Ç–æ–±—ã —Ç—ã –∑–Ω–∞–ª–∞: —Ç—ã –¥–ª—è –º–µ–Ω—è –º–Ω–æ–≥–æ –∑–Ω–∞—á–∏—à—å. –° 14 —Ñ–µ–≤—Ä–∞–ª—è, –º–æ—è –ª—é–±–∏–º–∞—è...', options: [
              { text: '–ò —Ç–µ–±—è ‚ù§Ô∏è', nextPerson: '–ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å?' }
          ]},
          { person: '–ù–∞—Å—Ç—è... —Ç—ã –º–µ–Ω—è –ª—é–±–∏—à—å? ‚ù§Ô∏è', options: [
              { text: '‚ù§Ô∏è –î–∞', nextPerson: '–Ø —Å–∞–º—ã–π —Å—á–∞—Å—Ç–ª–∏–≤—ã–π —á–µ–ª–æ–≤–µ–∫! –°–ø–∞—Å–∏–±–æ, –ª—é–±–∏–º–∞—è ‚ù§Ô∏è' },
              { text: 'üíñ –û—á–µ–Ω—å –¥–∞', nextPerson: '–¢—ã –¥–µ–ª–∞–µ—à—å –º–µ–Ω—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ —Å—á–∞—Å—Ç–ª–∏–≤—ã–º! üíñ' }
          ]},
          { person: '–Ø –ª—é–±–ª—é —Ç–µ–±—è ‚ù§Ô∏è', options: [] } // —Ñ–∏–Ω–∞–ª
        ]
      },
      { // 1. –ü–æ–¥—Ä—É–≥–∞ üå∏
        name: '–ü–æ–¥—Ä—É–≥–∞ üå∏',
        dialog: [
          { person: `${HER_NAME} üíï –¢—ã —Å–µ–≥–æ–¥–Ω—è –ø—Ä–æ—Å—Ç–æ —Å–∏—è–µ—à—å! –ü–ª–∞—Ç—å–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤—á–µ—Ä–∞ –º–µ—Ä–∏–ª–∞ ‚Äî –±–µ—Ä–∏!`, options: [
              { text: '–ü—Ä–∞–≤–¥–∞? –°–ø–∞—Å–∏–±–æ! –¢—ã –ª—É—á—à–∞—è —Å–æ–≤–µ—Ç—á–∏—Ü–∞', nextPerson: '–û–π, –¥–∞ –ª–∞–¥–Ω–æ! –¢—ã –∏ –±–µ–∑ –ø–ª–∞—Ç—å—è –∫–æ—Ä–æ–ª–µ–≤–∞.' },
              { text: '–ê –∫–∞–∫ —Ç–≤–æ–∏ –¥–µ–ª–∞ —Å —Ç–µ–º –ø–∞—Ä–Ω–µ–º?', nextPerson: '–û–π, –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞–π... –ù–∞–ø–∏—Å–∞–ª –≤—á–µ—Ä–∞ "–ø—Ä–∏–≤–µ—Ç" –∏ –ø—Ä–æ–ø–∞–ª. –ù–æ –º—ã –Ω–µ –æ –º–Ω–µ, –∞ –æ —Ç–µ–±–µ!' }
          ]},
          { person: '–°–ª—É—à–∞–π, –∞ —Ü–≤–µ—Ç—ã —Å–µ–≥–æ–¥–Ω—è –¥–∞—Ä–∏–ª–∏? –ü—Ä–∏–∑–Ω–∞–≤–∞–π—Å—è!', options: [
              { text: '–ù—É... –±—ã–ª–∏ –Ω–∞–º—ë–∫–∏ üòä', nextPerson: '–Ø –∑–Ω–∞–ª–∞! –¢—ã —Ç–∞–∫–∞—è –ª–∞–ø–æ—á–∫–∞, –∫–∞–∫ –º–æ–∂–Ω–æ –Ω–µ –¥–∞—Ä–∏—Ç—å?' },
              { text: '–ü–æ–∫–∞ –Ω–µ—Ç, –Ω–æ –¥–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–π', nextPerson: '–£–≤–µ—Ä–µ–Ω–∞, –µ—â—ë –±—É–¥–µ—Ç –º–æ—Ä–µ —Ü–≤–µ—Ç–æ–≤! –¢—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å.' }
          ]},
          { person: '–ö—Å—Ç–∞—Ç–∏, —è —Ç—É—Ç –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫—É —Ç–µ–±–µ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é ‚ù§Ô∏è', options: [
              { text: '–û–π, –ø–æ–∫–∞–∂–∏!', nextPerson: '–û–Ω–∞ –≤–Ω—É—Ç—Ä–∏: –±—É–¥—å —Å—á–∞—Å—Ç–ª–∏–≤–∞ –∏ —É–ª—ã–±–∞–π—Å—è –ø–æ—á–∞—â–µ üå∏' },
              { text: '–¢—ã —Å–∞–º–∞—è –º–∏–ª–∞—è', nextPerson: '–ú—ã —Å–∞–º—ã–µ –º–∏–ª—ã–µ! –° –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º, –ø–æ–¥—Ä—É–∂–∫–∞ ‚ù§Ô∏è' }
          ]},
          { person: '–¶–µ–ª—É—é —Ç–µ–±—è, –º–æ—è —Ö–æ—Ä–æ—à–∞—è! –° 14 —Ñ–µ–≤—Ä–∞–ª—è üíã', options: [] }
        ]
      },
      { // 2. –õ—É—á—à–∏–π –¥—Ä—É–≥ üòé
        name: '–õ—É—á—à–∏–π –¥—Ä—É–≥ üòé',
        dialog: [
          { person: `–ù–∞—Å—Ç—å–∫–∞, –ø—Ä–∏–≤–µ—Ç! –° 14 —Ñ–µ–≤—Ä–∞–ª—è! –¢—ã –∫–∞–∫ –≤—Å–µ–≥–¥–∞ –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∏ —Å–æ–±–∏—Ä–∞–µ—à—å? üòÇ`, options: [
              { text: '–ü—Ä–∏–≤–µ—Ç! –ê —Ç—ã –º–Ω–µ –ø—Ä–∏—Å–ª–∞–ª —á—Ç–æ-—Ç–æ?', nextPerson: '–ê –∫–∞–∫ –∂–µ! –î–µ—Ä–∂–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫: üß¶ (–Ω–æ—Å–∫–∏, –∫–∞–∫ —Ç—ã –ª—é–±–∏—à—å))' },
              { text: '–•–∞—Ö–∞, –ø—Ä–∏–≤–µ—Ç! –¢—ã –∫–∞–∫?', nextPerson: '–Ø –æ–≥–æ–Ω—å! –î–µ–≤—É—à–∫–∏ –∑–∞–≤–∞–ª–∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏, –Ω–æ —Ç—ã –≥–ª–∞–≤–Ω–∞—è!)' }
          ]},
          { person: '–ü–æ–º–Ω–∏—à—å, –∫–∞–∫ –º—ã –≤ —à–∫–æ–ª–µ –¥—É—Ä–∞—á–∏–ª–∏—Å—å? –ê —Å–µ–π—á–∞—Å —Ç—ã —Ç–∞–∫–∞—è –∫—Ä–∞—Å–∏–≤–∞—è —Å—Ç–∞–ª–∞...', options: [
              { text: '–ò –Ω–µ –≥–æ–≤–æ—Ä–∏, –≤—Ä–µ–º—è –ª–µ—Ç–∏—Ç', nextPerson: '–ê–≥–∞, –Ω–æ —Ç—ã –≤—Å—ë —Ç–∞ –∂–µ –∫–ª–∞—Å—Å–Ω–∞—è. –¢–æ–ª—å–∫–æ –µ—â—ë –∫—Ä—É—á–µ.' },
              { text: '–¢—ã —Ç–æ–∂–µ –Ω–∏—á–µ–≥–æ —Ç–∞–∫ üòé', nextPerson: '–°—Ç–∞—Ä–∞–µ–º—Å—è! –õ–∞–¥–Ω–æ, –±—É–¥—å —Å—á–∞—Å—Ç–ª–∏–≤–∞ –∏ —É–ª—ã–±–∞–π—Å—è –ø–æ—á–∞—â–µ üî•' }
          ]},
          { person: '–ö–æ—Ä–æ—á–µ, –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å —Ç–æ–ª—å–∫–æ —Å–∞–º–æ–≥–æ –ª—É—á—à–µ–≥–æ. –° –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º!', options: [
              { text: '–°–ø–∞—Å–∏–±–æ, –¥—Ä—É–≥!', nextPerson: '–û–±—Ä–∞—â–∞–π—Å—è! –ï—Å–ª–∏ —á—Ç–æ, —è —Ä—è–¥–æ–º.' }
          ]},
          { person: 'üåπ', options: [] }
        ]
      },
      { // 3. –†–æ–º–∞–Ω—Ç–∏–∫ üåô
        name: '–†–æ–º–∞–Ω—Ç–∏–∫ üåô',
        dialog: [
          { person: `${HER_NAME}, –¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä... –°–µ–≥–æ–¥–Ω—è —Ç–∞–∫–æ–π –∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç, —è —Å—Ä–∞–∑—É –æ —Ç–µ–±–µ –≤—Å–ø–æ–º–Ω–∏–ª.`, options: [
              { text: '–û—á–µ–Ω—å –º–∏–ª–æ —Å —Ç–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω—ã', nextPerson: '–¢–≤–æ—è —É–ª—ã–±–∫–∞ —Ç–µ–ø–ª–µ–µ —Å–æ–ª–Ω—Ü–∞, –ø—Ä–∞–≤–¥–∞.' },
              { text: '–¢—ã –ø–æ—ç—Ç?', nextPerson: '–ù–µ—Ç, –ø—Ä–æ—Å—Ç–æ —Ç—ã –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—à—å.' }
          ]},
          { person: '–¢—ã —Å–ª–æ–≤–Ω–æ —Å–æ—à–ª–∞ —Å –æ–±–ª–æ–∂–∫–∏ –ª—é–±–∏–º–æ–π –∫–Ω–∏–≥–∏. –í —Ç–≤–æ–∏—Ö –≥–ª–∞–∑–∞—Ö –º–æ–∂–Ω–æ —É—Ç–æ–Ω—É—Ç—å...', options: [
              { text: '–¢—ã –º–µ–Ω—è —Å–º—É—â–∞–µ—à—å...', nextPerson: '–ü—Ä–æ—Å—Ç–∏, –Ω–µ –º–æ–≥—É –º–æ–ª—á–∞—Ç—å, –∫–æ–≥–¥–∞ —Ç—ã —Ä—è–¥–æ–º.' },
              { text: '–°–ø–∞—Å–∏–±–æ, –º–Ω–µ –æ—á–µ–Ω—å –ø—Ä–∏—è—Ç–Ω–æ', nextPerson: '–≠—Ç–æ —Ç–µ–±–µ —Å–ø–∞—Å–∏–±–æ –∑–∞ —Ç–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å.' }
          ]},
          { person: '–° –¥–Ω—ë–º –≤—Å–µ—Ö –≤–ª—é–±–ª—ë–Ω–Ω—ã—Ö, –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞—è üåπ –ü—É—Å—Ç—å —Å–±—É–¥—É—Ç—Å—è —Å–∞–º—ã–µ –Ω–µ–∂–Ω—ã–µ –º–µ—á—Ç—ã.', options: [
              { text: '–ò —Ç–µ–±–µ –≤—Å–µ–≥–æ —Å–∞–º–æ–≥–æ —Å–≤–µ—Ç–ª–æ–≥–æ', nextPerson: '–ú–µ—á—Ç–∞—é, —á—Ç–æ–±—ã –º—ã –µ—â—ë —É–≤–∏–¥–µ–ª–∏—Å—å...' }
          ]},
          { person: '–û–±–Ω–∏–º–∞—é –º—ã—Å–ª–µ–Ω–Ω–æ...', options: [] }
        ]
      },
      { // 4. –¢–∞–π–Ω—ã–π –ø–æ–∫–ª–æ–Ω–Ω–∏–∫ ü§ç
        name: '–¢–∞–π–Ω—ã–π –ø–æ–∫–ª–æ–Ω–Ω–∏–∫ ü§ç',
        dialog: [
          { person: '–¢—ã –¥–∞–∂–µ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—à—å, –∫–∞–∫ —Ç—ã –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞...', options: [
              { text: '–ê –∫—Ç–æ —ç—Ç–æ?', nextPerson: '–¢–æ—Ç, –∫—Ç–æ –≤–∏–¥–∏—Ç —Ç–µ–±—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∏ –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–≤–µ—Å—Ç–∏ –≤–∑–≥–ª—è–¥.' },
              { text: '–°–ø–∞—Å–∏–±–æ, –æ—á–µ–Ω—å –∑–∞–≥–∞–¥–æ—á–Ω–æ', nextPerson: '–¢–≤–æ–π –≥–æ–ª–æ—Å –∑–≤—É—á–∏—Ç –∫–∞–∫ –º—É–∑—ã–∫–∞.' }
          ]},
          { person: '–¢—ã –æ—á–µ–Ω—å –¥–æ–±—Ä–∞—è –∏ –∏—Å–∫—Ä–µ–Ω–Ω—è—è. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è–π—Å—è.', options: [
              { text: '–û—Ç–∫—É–¥–∞ —Ç—ã –º–µ–Ω—è –∑–Ω–∞–µ—à—å?', nextPerson: '–≠—Ç–æ –ø–æ–∫–∞ —Å–µ–∫—Ä–µ—Ç. –ù–æ —è —Ä—è–¥–æ–º.' },
              { text: '–≠—Ç–æ —Ç–∞–∫ –ø—Ä–∏—è—Ç–Ω–æ —Å–ª—ã—à–∞—Ç—å', nextPerson: '–¢—ã –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å —Ç–æ–ª—å–∫–æ –¥–æ–±—Ä—ã—Ö —Å–ª–æ–≤.' }
          ]},
          { person: '–° 14 —Ñ–µ–≤—Ä–∞–ª—è, –ù–∞—Å—Ç—è... —Ç—ã –ª—É—á—à–µ –≤—Å–µ—Ö. ü§ç', options: [] }
        ]
      },
      { // 5. –í–µ—Å–Ω–∞ üå∑
        name: '–í–µ—Å–Ω–∞ üå∑',
        dialog: [
          { person: '–° –ø–µ—Ä–≤—ã–º –¥–Ω—ë–º –≤–µ—Å–Ω—ã, —Ö–æ—Ç—è –µ—â—ë —Ñ–µ–≤—Ä–∞–ª—å! –¢—ã –ø–∞—Ö–Ω–µ—à—å –∫–∞–∫ –ø–µ—Ä–≤—ã–µ —Ü–≤–µ—Ç—ã...', options: [
              { text: 'üå∏ –°–ø–∞—Å–∏–±–æ, –º–∏–ª–∞—è', nextPerson: '–†—è–¥–æ–º —Å —Ç–æ–±–æ–π –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è –≤—Å—ë –∂–∏–≤–æ–µ.' },
              { text: '–¢—ã —Å–∞–º–æ —Ç–µ–ø–ª–æ', nextPerson: '–ê —Ç—ã ‚Äî —Å–æ–ª–Ω—Ü–µ.' }
          ]},
          { person: '–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –∑–∞—Ä—è–∂–∞–µ—Ç. –° 14 —Ñ–µ–≤—Ä–∞–ª—è, —Å–∞–º–æ–µ —Ç—ë–ø–ª–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ üíê', options: [
              { text: '–ò —Ç–µ–±—è —Å –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º!', nextPerson: '–î–∞–≤–∞–π –¥—Ä—É–∂–∏—Ç—å –≤–µ—á–Ω–æ?' },
              { text: '–û–±–Ω–∏–º–∞—é', nextPerson: '–í–∑–∞–∏–º–Ω–æ üå∑' }
          ]},
          { person: 'üåøüåº', options: [] }
        ]
      },
      { // 6. –ü–æ—ç—Ç ‚ú®
        name: '–ü–æ—ç—Ç ‚ú®',
        dialog: [
          { person: '–¢—ã ‚Äî —Å—Ç—Ä–æ—á–∫–∞, —á—Ç–æ –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –≥–æ–ª–æ–≤—ã. –¢–∏—Ö–∞—è –Ω–µ–∂–Ω–æ—Å—Ç—å, —Å–≤–µ—Ç–ª–∞—è –≥—Ä—É—Å—Ç—å...', options: [
              { text: '–≠—Ç–æ —Å—Ç–∏—Ö–∏?', nextPerson: '–≠—Ç–æ —Ç—ã. –¢—ã ‚Äî –ø–æ—ç–º–∞.' },
              { text: '–ö—Ä–∞—Å–∏–≤–æ', nextPerson: '–¢–≤–æ–∏ —Ä—É–∫–∏ ‚Äî –¥–≤–∞ –±–µ–ª—ã—Ö –∫—Ä—ã–ª–∞.' }
          ]},
          { person: '–Ø –ø–∏—à—É —Ç–µ–±–µ —Å–µ—Ä–¥—Ü–µ–º. –ë—É–¥—å –º—É–∑–æ–π –≤–µ—á–Ω–æ.', options: [
              { text: '‚ù§Ô∏è', nextPerson: '–¢—ã —Å–æ–≥–ª–∞—Å–Ω–∞?' },
              { text: '–¢—ã –æ—á–µ–Ω—å —Ç–∞–ª–∞–Ω—Ç–ª–∏–≤', nextPerson: '–≠—Ç–æ —Ç—ã –º–µ–Ω—è –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—à—å.' }
          ]},
          { person: '–° –¥–Ω—ë–º –≤–ª—é–±–ª—ë–Ω–Ω—ã—Ö, –ù–∞—Å—Ç—è. ‚úçÔ∏è‚ù§Ô∏è', options: [] }
        ]
      },
      { // 7. –°–æ–ª–Ω—ã—à–∫–æ ‚òÄÔ∏è
        name: '–°–æ–ª–Ω—ã—à–∫–æ ‚òÄÔ∏è',
        dialog: [
          { person: '–ù–∞—Å—Ç—è-–ª—É—á–∏–∫–∏! –¢—ã –≥—Ä–µ–µ—à—å –º–µ–Ω—è –¥–∞–∂–µ –∫–æ–≥–¥–∞ –ø–∞—Å–º—É—Ä–Ω–æ.', options: [
              { text: '–¢—ã —Ç–æ–∂–µ –º–æ—ë —Å–æ–ª–Ω—Ü–µ', nextPerson: '–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å.' },
              { text: '–õ—é–±–ª—é —Ç–µ–±—è ‚òÄÔ∏è', nextPerson: '–ò —è —Ç–µ–±—è! –ö—Ä–µ–ø–∫–æ-–∫—Ä–µ–ø–∫–æ.' }
          ]},
          { person: '–° 14 —Ñ–µ–≤—Ä–∞–ª—è, –º–æ—ë —Ç–µ–ø–ª–æ. –û–±–Ω–∏–º–∞—é –º—ã—Å–ª–µ–Ω–Ω–æ', options: [
              { text: '–û–±–Ω–∏–º–∞—é –≤ –æ—Ç–≤–µ—Ç', nextPerson: '–¢–µ–ø–µ—Ä—å –¥–µ–Ω—å —Ç–æ—á–Ω–æ —É–¥–∞–ª—Å—è ‚ù§Ô∏è' }
          ]},
          { person: '‚òÄÔ∏è‚ù§Ô∏è', options: [] }
        ]
      }
    ];

    // ---------- DOM —ç–ª–µ–º–µ–Ω—Ç—ã ----------
    const chatListEl = document.getElementById('chatList');
    const chatWindow = document.getElementById('chatWindow');
    const chatTitle = document.getElementById('chatTitle');
    const chatAvatar = document.getElementById('chatAvatar');
    const messagesDiv = document.getElementById('messages');
    const statusEl = document.getElementById('status');
    const optionsArea = document.getElementById('optionsArea');
    const manualInputArea = document.getElementById('manualInputArea');
    const userInput = document.getElementById('userInput');

    let currentChat = null;           // —Ç–µ–∫—É—â–∏–π –æ–±—ä–µ–∫—Ç —á–∞—Ç–∞
    let currentDialog = null;         // –º–∞—Å—Å–∏–≤ —à–∞–≥–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞
    let stepIndex = 0;                // —Ç–µ–∫—É—â–∏–π —à–∞–≥ (–∏–Ω–¥–µ–∫—Å –≤ dialog)
    let timeoutId = null;
    let waitingForUser = false;       // —Ñ–ª–∞–≥, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–∏ —Å–µ–π—á–∞—Å –∫–Ω–æ–ø–∫–∏

    // –º—É–∑—ã–∫–∞
    const music = document.getElementById('bgMusic');
    music.volume = 0.2;
    music.play().catch(() => {});

    // ---------- –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤ ----------
    chats.forEach((chat, i) => {
      const div = document.createElement('div');
      div.className = 'chat-item';
      div.innerHTML = `
        <div class="avatar" style="background-image:url('${avatars[i % avatars.length]}')"></div>
        <div class="chat-info">
          <div class="chat-name">${chat.name}</div>
          <div class="chat-last">${chat.dialog[0]?.person || '...'}</div>
        </div>
        <div class="chat-time">‚ù§Ô∏è</div>
      `;
      div.onclick = () => openChat(i);
      chatListEl.appendChild(div);
    });

    // ---------- –æ—Ç–∫—Ä—ã—Ç—å —á–∞—Ç ----------
    function openChat(index) {
      if (timeoutId) clearTimeout(timeoutId);
      currentChat = chats[index];
      currentDialog = currentChat.dialog.slice(); // –∫–æ–ø–∏—è
      stepIndex = 0;

      chatTitle.innerText = currentChat.name;
      chatAvatar.style.backgroundImage = `url('${avatars[index % avatars.length]}')`;
      messagesDiv.innerHTML = '';
      chatWindow.classList.add('active');
      statusEl.innerText = '–≤ —Å–µ—Ç–∏';

      // —Å–∫—Ä—ã–≤–∞–µ–º —Ä—É—á–Ω–æ–π –≤–≤–æ–¥ (–±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏), –Ω–æ –æ—Å—Ç–∞–≤–∏–º –Ω–∞ —Å–ª—É—á–∞–π
      manualInputArea.style.display = 'flex';
      optionsArea.style.display = 'none';
      optionsArea.innerHTML = '';

      // –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—ã–π —à–∞–≥
      showCurrentPersonMessage();
    }

    window.closeChat = function() {
      chatWindow.classList.remove('active');
      if (timeoutId) clearTimeout(timeoutId);
    };

    // ---------- –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–∞ —Ç–µ–∫—É—â–µ–º —à–∞–≥–µ ----------
    function showCurrentPersonMessage() {
      if (!currentDialog || stepIndex >= currentDialog.length) {
        // –¥–∏–∞–ª–æ–≥ –æ–∫–æ–Ω—á–µ–Ω
        statusEl.innerText = '–æ–Ω–ª–∞–π–Ω';
        optionsArea.style.display = 'none';
        return;
      }

      const step = currentDialog[stepIndex];
      statusEl.innerText = '–ø–µ—á–∞—Ç–∞–µ—Ç...';

      timeoutId = setTimeout(() => {
        statusEl.innerText = '–≤ —Å–µ—Ç–∏';
        addMessage(step.person, 'received');
        // –ø–æ—Å–ª–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å)
        if (step.options && step.options.length > 0) {
          showOptions(step.options);
        } else {
          // –Ω–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ‚Äî –¥–∏–∞–ª–æ–≥ –∑–∞–≤–µ—Ä—à—ë–Ω
          optionsArea.style.display = 'none';
        }
      }, 1000);
    }

    // ---------- –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ ----------
    function showOptions(options) {
      optionsArea.innerHTML = '';
      options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.innerText = opt.text;
        btn.onclick = () => onOptionSelected(opt);
        optionsArea.appendChild(btn);
      });
      optionsArea.style.display = 'flex';
      waitingForUser = true;
    }

    // ---------- –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ ----------
    function onOptionSelected(opt) {
      if (!waitingForUser) return;
      waitingForUser = false;
      optionsArea.style.display = 'none'; // —Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å –∞–Ω–∏–º–∞—Ü–∏–µ–π)
      statusEl.innerText = '–ø–µ—á–∞—Ç–∞–µ—Ç...';
      setTimeout(() => {
        addMessage(opt.text, 'sent');
        statusEl.innerText = '–≤ —Å–µ—Ç–∏';

        // —á–µ—Ä–µ–∑ –ø–∞—É–∑—É ‚Äî –æ—Ç–≤–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        if (opt.nextPerson) {
          timeoutId = setTimeout(() => {
            addMessage(opt.nextPerson, 'received');
            // –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É (–∏–Ω–¥–µ–∫—Å —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º)
            stepIndex++;
            if (stepIndex < currentDialog.length) {
              // –Ω–æ –æ—Ç–≤–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –º–æ–≥ –±—ã—Ç—å –Ω–µ –∏–∑ —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞, –∞ –∏–∑ –ø–æ–ª—è nextPerson.
              // –ú—ã —É–∂–µ –¥–æ–±–∞–≤–∏–ª–∏ –æ—Ç–≤–µ—Ç, —Ç–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É –∏ –ø–æ–∫–∞–∑–∞—Ç—å –µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–µ,
              // –Ω–æ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–∂–µ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞. 
              // –û–¥–Ω–∞–∫–æ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ: –º—ã —É–∂–µ –ø–æ–∫–∞–∑–∞–ª–∏ nextPerson –∫–∞–∫ –æ—Ç–≤–µ—Ç, –∏ –æ–Ω –º–æ–∂–µ—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å person –∏–∑ —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞.
              // –õ–æ–≥–∏—á–Ω–µ–µ: –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (nextPerson) –º—ã –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É –∏ –ø–æ–∫–∞–∑–∞—Ç—å –µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å).
              // –ù–æ –∏–Ω–æ–≥–¥–∞ –æ—Ç–≤–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–º. –£—á—Ç–µ–º —ç—Ç–æ.
              // –£ –Ω–∞—Å –≤ opt.nextPerson –ª–µ–∂–∏—Ç —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞. –ü–æ—Å–ª–µ –Ω–µ–≥–æ –¥–æ–ª–∂–µ–Ω –∏–¥—Ç–∏ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ (–Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞).
              // –ü–æ—ç—Ç–æ–º—É –º—ã –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ person —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞, –∞ –ø—Ä–æ—Å—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º stepIndex –∏ –∑–∞—Ç–µ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞.
              // –û–¥–Ω–∞–∫–æ –º—ã —É–∂–µ –ø–æ–∫–∞–∑–∞–ª–∏ –æ—Ç–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–∏–±–æ —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º, –ª–∏–±–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–ø–ª–∏–∫–æ–π.
              // –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–µ–π, —Å–¥–µ–ª–∞–µ–º —Ç–∞–∫: opt.nextPerson ‚Äî —ç—Ç–æ –æ—Ç–≤–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–∞ –Ω–∞—à –≤—ã–±–æ—Ä. –ü–æ—Å–ª–µ –Ω–µ–≥–æ –º—ã –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É (–∏–Ω–¥–µ–∫—Å +1) –∏ –ø–æ–∫–∞–∑–∞—Ç—å –µ–≥–æ person (–µ—Å–ª–∏ –µ—Å—Ç—å).
              // –ù–æ –≤–æ–∑–º–æ–∂–Ω–æ, —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ —É–∂–µ –≤–∫–ª—é—á—ë–Ω –≤ –æ—Ç–≤–µ—Ç. –õ—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç—å nextStepIndex, –Ω–æ –ø—Ä–æ—â–µ: –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ.
              // –û–¥–Ω–∞–∫–æ –≤ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ opt.nextPerson ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç, –∏ –æ–Ω –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ stepIndex. –ü–æ—ç—Ç–æ–º—É –º—ã –ø–æ–∫–∞–∂–µ–º –µ–≥–æ –∫–∞–∫ –æ—Ç–≤–µ—Ç, –∞ –∑–∞—Ç–µ–º —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –ø–æ–∫–∞–∂–µ–º person –∏–∑ —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞.
              // –ù–æ —Ç–æ–≥–¥–∞ –ø–æ–ª—É—á–∏—Ç—Å—è –¥–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥—Ä—è–¥ –æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–æ—Ç–≤–µ—Ç –∏ —Å–ª–µ–¥—É—é—â–µ–µ). –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —ç—Ç–æ–≥–æ, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, —á—Ç–æ opt.nextPerson –∏ –µ—Å—Ç—å —Ç–æ —Å–∞–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞. –¢–æ–≥–¥–∞ –≤ –¥–∏–∞–ª–æ–≥–µ person —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞ –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å nextPerson? –ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.
              // –ü–µ—Ä–µ–¥–µ–ª–∞–µ–º –ø–æ–¥—Ö–æ–¥: –ø—É—Å—Ç—å –∫–∞–∂–¥—ã–π —à–∞–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç person –∏ options. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–ø—Ü–∏–∏ –º—ã –¥–æ–±–∞–≤–ª—è–µ–º user message, –∞ –∑–∞—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º person —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞ (–±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞). –ù–æ —Ç–æ–≥–¥–∞ —Ç–µ—Ä—è–µ—Ç—Å—è –≥–∏–±–∫–æ—Å—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ—Ç–≤–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –≤—ã–±–æ—Ä–∞. 
              // –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: –ø—É—Å—Ç—å –≤ options –ª–µ–∂–∏—Ç { text, nextPersonReply }, –∏ –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º nextPersonReply –∫–∞–∫ –æ—Ç–≤–µ—Ç, –∞ –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É (stepIndex+1) –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ person (–µ—Å–ª–∏ –µ—Å—Ç—å). –≠—Ç–æ –¥–∞–µ—Ç –¥–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –ø–æ–¥—Ä—è–¥ (reply + —Å–ª–µ–¥—É—é—â–µ–µ), —á—Ç–æ –¥–æ–ø—É—Å—Ç–∏–º–æ.
              // –õ–∏–±–æ —Å–¥–µ–ª–∞—Ç—å, —á—Ç–æ nextPersonReply –∑–∞–º–µ–Ω—è–µ—Ç —Å–æ–±–æ–π —Å–ª–µ–¥—É—é—â–µ–µ person, –∏ —Ç–æ–≥–¥–∞ –º—ã –Ω–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º stepIndex, –∞ –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥. –ù–æ —Ç–æ–≥–¥–∞ —Å–ª–æ–∂–Ω–µ–µ.
              // –í —Ü–µ–ª—è—Ö –ø—Ä–æ—Å—Ç–æ—Ç—ã —Ä–∞–∑—Ä–µ—à–∏–º –¥–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥—Ä—è–¥: —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–≤–µ—Ç –Ω–∞ –≤—ã–±–æ—Ä, –ø–æ—Ç–æ–º —Å–ª–µ–¥—É—é—â–∞—è —Ä–µ–ø–ª–∏–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞. –≠—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–π.
              timeoutId = setTimeout(() => {
                stepIndex++;
                if (stepIndex < currentDialog.length) {
                  // –ø–æ–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                  const nextStep = currentDialog[stepIndex];
                  addMessage(nextStep.person, 'received');
                  // –µ—Å–ª–∏ —É —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞ –µ—Å—Ç—å –æ–ø—Ü–∏–∏, –ø–æ–∫–∞–∑–∞—Ç—å –∏—Ö
                  if (nextStep.options && nextStep.options.length > 0) {
                    showOptions(nextStep.options);
                  } else {
                    optionsArea.style.display = 'none';
                  }
                } else {
                  // –¥–∏–∞–ª–æ–≥ –æ–∫–æ–Ω—á–µ–Ω
                  optionsArea.style.display = 'none';
                }
              }, 1200);
            } else {
              // –¥–∏–∞–ª–æ–≥ –æ–∫–æ–Ω—á–µ–Ω –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞
            }
          }, 1000);
        } else {
          // –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
          stepIndex++;
          if (stepIndex < currentDialog.length) {
            timeoutId = setTimeout(() => {
              showCurrentPersonMessage();
            }, 1000);
          }
        }
      }, 800); // –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    }

    // ---------- –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ: –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ ----------
    function addMessage(text, type) {
      const msgDiv = document.createElement('div');
      msgDiv.className = `message ${type}`;
      const time = new Date().toLocaleTimeString('ru-Ru', { hour: '2-digit', minute: '2-digit' });
      msgDiv.innerHTML = `${text} <span class="time">${time}</span>`;
      messagesDiv.appendChild(msgDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // ---------- —Ä—É—á–Ω–æ–π –≤–≤–æ–¥ (–∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç) ----------
    window.sendManualMessage = function() {
      const text = userInput.value.trim();
      if (!text) return;
      addMessage(text, 'sent');
      userInput.value = '';
      // –µ—Å–ª–∏ –¥–∏–∞–ª–æ–≥ –µ—â—ë –∏–¥—ë—Ç, –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –ø–∞—É–∑—É –≤—ã–∑–≤–∞—Ç—å next (–Ω–æ –∑–¥–µ—Å—å –º—ã –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ–º —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É)
      // –ø—Ä–æ—Å—Ç–æ –∑–∞–≥–ª—É—à–∫–∞: —á–µ—Ä–µ–∑ 2 —Å–µ–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂ –Ω–∞–ø–∏—à–µ—Ç —á—Ç–æ-—Ç–æ –æ–±—â–µ–µ
      if (currentDialog && stepIndex < currentDialog.length) {
        statusEl.innerText = '–ø–µ—á–∞—Ç–∞–µ—Ç...';
        setTimeout(() => {
          statusEl.innerText = '–≤ —Å–µ—Ç–∏';
          addMessage('üòä', 'received');
        }, 1500);
      }
    };

    // ---------- —Å–µ—Ä–¥–µ—á–∫–∏ (—ç—Ñ—Ñ–µ–∫—Ç) ----------
    function createHeart() {
      const heart = document.createElement('div');
      heart.className = 'heart';
      heart.innerText = '‚ù§Ô∏è';
      heart.style.left = Math.random() * 100 + '%';
      heart.style.bottom = '0';
      heart.style.fontSize = (15 + Math.random() * 30) + 'px';
      heart.style.animationDuration = (3 + Math.random() * 4) + 's';
      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), 5000);
    }

    // —Å–µ—Ä–¥–µ—á–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', () => {
      for (let i = 0; i < 12; i++) setTimeout(createHeart, i * 200);
    });

    // —Å–µ—Ä–¥–µ—á–∫–∏ –ø–æ –¥–æ–ª–≥–æ–º—É —Ç–∞–ø—É –Ω–∞ –∞–≤–∞—Ç–∞—Ä
    document.addEventListener('touchstart', (e) => {
      if (e.target.closest('.avatar')) {
        for (let i = 0; i < 10; i++) setTimeout(createHeart, i * 40);
      }
    });
  })();
</script>

<div class="desktop-hint">

</div>

</body>
</html>
